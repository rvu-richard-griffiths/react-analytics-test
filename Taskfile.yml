version: '3'

vars:
  PROJECT_NAME: react-analytics-ui

tasks:
  install:
    desc: Install dependencies
    cmds:
      - npm install

  build:
    desc: Build the library for production
    cmds:
      - npm run build

  dev:
    desc: Start Storybook development server
    cmds:
      - npm run storybook

  build-storybook:
    desc: Build Storybook for deployment
    cmds:
      - npm run build-storybook

  lint:
    desc: Run ESLint
    cmds:
      - npm run lint

  lint-fix:
    desc: Run ESLint with auto-fix
    cmds:
      - npm run lint -- --fix

  type-check:
    desc: Run TypeScript type checking
    cmds:
      - npm run type-check

  test:
    desc: Run tests
    cmds:
      - npm test

  clean:
    desc: Remove build artifacts and node_modules
    cmds:
      - rm -rf dist storybook-static node_modules

  generate-ai-docs:
    desc: Generate AI-consumable documentation for component library
    cmds:
      - node scripts/generate-ai-docs.js

  # Demo commands
  demo-up:
    desc: Start NATS analytics demo (Docker containers)
    cmds:
      - docker-compose up -d
      - echo "NATS analytics demo started"
      - echo "NATS Server http://localhost:8222"
      - echo "Bridge API http://localhost:3001"
      - echo "View logs task demo-logs"

  demo-down:
    desc: Stop NATS analytics demo
    cmds:
      - docker-compose down
      - echo "NATS analytics demo stopped"

  demo-logs:
    desc: View real-time analytics events (subscriber logs)
    cmds:
      - docker-compose logs -f analytics-subscriber

  demo-logs-all:
    desc: View all demo container logs
    cmds:
      - docker-compose logs -f

  demo-restart:
    desc: Restart NATS analytics demo
    cmds:
      - task: demo-down
      - task: demo-up

  demo-build:
    desc: Rebuild demo containers
    cmds:
      - docker-compose build --no-cache
      - echo "Demo containers rebuilt"

  demo-status:
    desc: Check demo container status
    cmds:
      - docker-compose ps

  demo-dev:
    desc: Start Storybook with NATS analytics demo
    cmds:
      - task: demo-up
      - sleep 3
      - npm run storybook

  validate:
    desc: Run all validation checks (lint, type-check, build)
    cmds:
      - task: lint
      - task: type-check
      - task: build

  format:
    desc: Format code (add prettier if needed)
    cmds:
      - echo "Add prettier configuration for code formatting"

  prepublish:
    desc: Prepare package for publishing
    cmds:
      - task: clean
      - task: install
      - task: validate
      - task: test

  publish:
    desc: Publish package to npm
    cmds:
      - task: prepublish
      - npm publish

  default:
    desc: Display available tasks
    cmds:
      - task --list
